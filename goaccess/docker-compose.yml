version: '3.8'

services:
  goaccess:
    image: allinurl/goaccess:latest
    container_name: goaccess
    command: >-
      /logs/access.log
      --config-file=/etc/goaccess/goaccess.conf
      --output=/reports/index.html
      --real-time-html
      --addr=0.0.0.0
      --port=7890
    volumes:
      - ../frontend/logs/nginx:/logs:ro
      - ./goaccess.conf:/etc/goaccess/goaccess.conf:ro
      - ./reports:/reports
    ports:
      - "7890:7890" # WebSocket for real-time updates
    restart: unless-stopped

  report-server:
    image: nginx:alpine
    container_name: goaccess-report-server
    depends_on:
      - goaccess
    volumes:
      - ./reports:/usr/share/nginx/html:ro
    ports:
      - "8081:80" # Serve the generated report at http://localhost:8081
    restart: unless-stopped

volumes: {}


